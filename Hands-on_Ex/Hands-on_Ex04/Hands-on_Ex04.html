<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>IS415-GAA - Hands On Exercise 4: Spatial Weights and Applications</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415-GAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/hands_on_1.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/hands_on_2.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/hands_on_3_1.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 3.1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/hands_on_3_2.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 3.2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex08.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex09/Hands-on_Ex09.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10/Hands-on_Ex10.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 10</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">In-class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex02/In-class_Ex02.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex03/In-class_Ex03.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex03/In-class_Ex03-Network.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 3 - Network</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://is415-gaa-yozafard.netlify.app/in-class_ex/in-class_ex04/in-class_ex04" rel="" target="">
 <span class="dropdown-text">In-class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex05/In-class_Ex05.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex05/In-class_Ex05-EHSA.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 5 - EHSA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex06/In-class_Ex06.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex07/In-class_Ex07.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex09/In-class_Ex09.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 9</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Take Home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex01/Take-home_Ex01.html" rel="" target="">
 <span class="dropdown-text">Take Home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex02/Take-home_Ex02.html" rel="" target="">
 <span class="dropdown-text">Take Home Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex03/Take-home_Ex03_KDE.html" rel="" target="">
 <span class="dropdown-text">Take Home Exercise 3</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">Packages</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a></li>
  </ul></li>
  <li><a href="#computing-contiguity-spatial-weights" id="toc-computing-contiguity-spatial-weights" class="nav-link" data-scroll-target="#computing-contiguity-spatial-weights">Computing Contiguity Spatial Weights</a>
  <ul class="collapse">
  <li><a href="#queen-based" id="toc-queen-based" class="nav-link" data-scroll-target="#queen-based">QUEEN Based</a></li>
  <li><a href="#rook-based" id="toc-rook-based" class="nav-link" data-scroll-target="#rook-based">ROOK Based</a></li>
  <li><a href="#visualising-contiguity-weights" id="toc-visualising-contiguity-weights" class="nav-link" data-scroll-target="#visualising-contiguity-weights">Visualising Contiguity Weights</a>
  <ul class="collapse">
  <li><a href="#plotting-queen-contiguity-based-neighbours-map" id="toc-plotting-queen-contiguity-based-neighbours-map" class="nav-link" data-scroll-target="#plotting-queen-contiguity-based-neighbours-map">Plotting Queen contiguity based neighbours map</a></li>
  <li><a href="#plotting-rook-contiguity-based-neighbours-map" id="toc-plotting-rook-contiguity-based-neighbours-map" class="nav-link" data-scroll-target="#plotting-rook-contiguity-based-neighbours-map">Plotting Rook contiguity based neighbours map</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#computing-distance-based-neighbours" id="toc-computing-distance-based-neighbours" class="nav-link" data-scroll-target="#computing-distance-based-neighbours">Computing Distance Based Neighbours</a>
  <ul class="collapse">
  <li><a href="#identifying-cut-off-distance" id="toc-identifying-cut-off-distance" class="nav-link" data-scroll-target="#identifying-cut-off-distance">Identifying cut-off distance</a></li>
  <li><a href="#computing-fixed-distance-weight-matrix" id="toc-computing-fixed-distance-weight-matrix" class="nav-link" data-scroll-target="#computing-fixed-distance-weight-matrix">Computing Fixed Distance Weight Matrix</a>
  <ul class="collapse">
  <li><a href="#plotting-fixed-distance-weight-matrix" id="toc-plotting-fixed-distance-weight-matrix" class="nav-link" data-scroll-target="#plotting-fixed-distance-weight-matrix">Plotting Fixed Distance Weight Matrix</a></li>
  </ul></li>
  <li><a href="#computing-adaptive-distance-weight-matrix" id="toc-computing-adaptive-distance-weight-matrix" class="nav-link" data-scroll-target="#computing-adaptive-distance-weight-matrix">Computing Adaptive Distance Weight Matrix</a>
  <ul class="collapse">
  <li><a href="#plotting-adaptive-distance-weight-matrix" id="toc-plotting-adaptive-distance-weight-matrix" class="nav-link" data-scroll-target="#plotting-adaptive-distance-weight-matrix">Plotting Adaptive Distance Weight Matrix</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#weights-based-on-idw" id="toc-weights-based-on-idw" class="nav-link" data-scroll-target="#weights-based-on-idw">Weights Based on IDW</a>
  <ul class="collapse">
  <li><a href="#row-standardised-weight-matrix" id="toc-row-standardised-weight-matrix" class="nav-link" data-scroll-target="#row-standardised-weight-matrix">Row-Standardised Weight Matrix</a></li>
  </ul></li>
  <li><a href="#application-of-spatial-weight-matrix" id="toc-application-of-spatial-weight-matrix" class="nav-link" data-scroll-target="#application-of-spatial-weight-matrix">Application of Spatial Weight Matrix</a>
  <ul class="collapse">
  <li><a href="#spatial-lag-with-row-standardized-weights" id="toc-spatial-lag-with-row-standardized-weights" class="nav-link" data-scroll-target="#spatial-lag-with-row-standardized-weights">Spatial Lag With Row-Standardized Weights</a></li>
  <li><a href="#spatial-lag-as-sum-of-neighboring-values" id="toc-spatial-lag-as-sum-of-neighboring-values" class="nav-link" data-scroll-target="#spatial-lag-as-sum-of-neighboring-values">Spatial Lag As Sum of Neighboring Values</a></li>
  <li><a href="#spatial-window-average" id="toc-spatial-window-average" class="nav-link" data-scroll-target="#spatial-window-average">Spatial Window Average</a></li>
  <li><a href="#spatial-window-sum" id="toc-spatial-window-sum" class="nav-link" data-scroll-target="#spatial-window-sum">Spatial Window Sum</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Hands On Exercise 4: Spatial Weights and Applications</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="overview" class="level1">
<h1>Overview</h1>
<p>In this hands-on exercise, we will learn how to compute spatial weights using R. By the end to this hands-on exercise, we will be able to:</p>
<ul>
<li>import geospatial data using appropriate function(s) of sf package,</li>
<li>import csv file using appropriate function of readr package,</li>
<li>perform relational join using appropriate join function of dplyr package,</li>
<li>compute spatial weights using appropriate functions of spdep package, and</li>
<li>calculate spatially lagged variables using appropriate functions of spdep package</li>
</ul>
</section>
<section id="packages" class="level1">
<h1>Packages</h1>
<p>Let’s start with loading the required packages as listed above</p>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>We are using two datasets: - Hunan county boundary layer. This is a geospatial data set in ESRI shapefile format. - Hunan_2012.csv: This csv file contains selected Hunan’s local development indicators in 2012</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Hunan' from data source 
  `C:\Users\yozaf\SMUY3S2\Geospatial\IS415-GAA\Hands-on_Ex\Hands-on_Ex04\data\geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 88 features and 7 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 108.7831 ymin: 24.6342 xmax: 114.2544 ymax: 30.12812
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Hunan_2012' from data source 
  `C:\Users\yozaf\SMUY3S2\Geospatial\IS415-GAA\Hands-on_Ex\Hands-on_Ex04\data\aspatial\Hunan_2012.csv' 
  using driver `CSV'</code></pre>
</div>
</div>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data Preparation</h2>
<p>Let’s combine the geospatial data with the aspatial data</p>
<p>Let’s take a look at the combined hunan data</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>    NAME_2               ID_3          NAME_3           ENGTYPE_3        
 Length:88          Min.   :21098   Length:88          Length:88         
 Class :character   1st Qu.:21125   Class :character   Class :character  
 Mode  :character   Median :21150   Mode  :character   Mode  :character  
                    Mean   :21150                                        
                    3rd Qu.:21174                                        
                    Max.   :21201                                        
   Shape_Leng       Shape_Area         County              City          
 Min.   :0.7722   Min.   :0.02128   Length:88          Length:88         
 1st Qu.:2.2533   1st Qu.:0.13669   Class :character   Class :character  
 Median :2.5844   Median :0.18564   Mode  :character   Mode  :character  
 Mean   :2.6057   Mean   :0.19274                                        
 3rd Qu.:3.0994   3rd Qu.:0.23735                                        
 Max.   :4.5835   Max.   :0.53452                                        
   avg_wage            deposite            FAI           Gov_Rev      
 Length:88          Min.   :  564.1   Min.   : 1005   Min.   : 108.4  
 Class :character   1st Qu.: 4306.9   1st Qu.: 3911   1st Qu.: 307.3  
 Mode  :character   Median : 6677.3   Median : 6854   Median : 455.2  
                    Mean   : 7514.1   Mean   : 9021   Mean   : 646.7  
                    3rd Qu.: 9502.6   3rd Qu.:10212   3rd Qu.: 637.3  
                    Max.   :24332.0   Max.   :49234   Max.   :5350.0  
    Gov_Exp            GDP            GDPPC            GIO        
 Min.   : 683.6   Min.   : 1490   Min.   : 8497   Min.   :   514  
 1st Qu.:1451.7   1st Qu.: 5844   1st Qu.:14566   1st Qu.:  4965  
 Median :2037.0   Median :10483   Median :20433   Median : 10698  
 Mean   :2155.9   Mean   :14931   Mean   :24405   Mean   : 19227  
 3rd Qu.:2638.1   3rd Qu.:19131   3rd Qu.:27224   3rd Qu.: 22223  
 Max.   :7885.5   Max.   :88009   Max.   :88656   Max.   :148976  
      Loan           NIPCR            Bed            Emp        
 Min.   :  358   Min.   : 2895   Min.   : 392   Min.   : 73.65  
 1st Qu.: 2242   1st Qu.: 3981   1st Qu.:1111   1st Qu.:231.56  
 Median : 3683   Median : 6119   Median :1642   Median :363.79  
 Mean   : 4687   Mean   : 7095   Mean   :1765   Mean   :388.71  
 3rd Qu.: 5082   3rd Qu.: 9768   3rd Qu.:2240   3rd Qu.:525.04  
 Max.   :40534   Max.   :17070   Max.   :6225   Max.   :919.62  
      EmpR           EmpRT          Pri_Stu          Sec_Stu      
 Min.   : 62.0   Min.   : 33.6   Min.   :  5.91   Min.   : 3.201  
 1st Qu.:191.2   1st Qu.:105.5   1st Qu.: 24.09   1st Qu.:15.095  
 Median :284.2   Median :171.2   Median : 36.85   Median :24.834  
 Mean   :316.4   Mean   :190.4   Mean   : 43.08   Mean   :27.609  
 3rd Qu.:433.5   3rd Qu.:263.5   3rd Qu.: 58.26   3rd Qu.:36.248  
 Max.   :757.6   Max.   :451.6   Max.   :112.20   Max.   :68.853  
   Household       Household_R          NOIP           Pop_R      
 Min.   : 27.15   Min.   : 30.40   Min.   : 10.0   Min.   : 57.7  
 1st Qu.: 99.15   1st Qu.: 87.95   1st Qu.: 47.0   1st Qu.:227.3  
 Median :162.85   Median :152.85   Median : 80.5   Median :348.7  
 Mean   :175.04   Mean   :159.62   Mean   :107.3   Mean   :369.3  
 3rd Qu.:245.32   3rd Qu.:218.22   3rd Qu.:124.0   3rd Qu.:517.0  
 Max.   :391.70   Max.   :369.80   Max.   :733.0   Max.   :834.1  
      RSCG             Pop_T             Agri            Service       
 Min.   :  354.5   Min.   :  92.3   Min.   :  527.2   Min.   :    5.2  
 1st Qu.: 1757.2   1st Qu.: 333.1   1st Qu.: 2255.3   1st Qu.: 1576.1  
 Median : 3437.8   Median : 572.5   Median : 3700.7   Median : 5932.5  
 Mean   : 4164.7   Mean   : 586.8   Mean   : 4705.9   Mean   : 8678.9  
 3rd Qu.: 5630.2   3rd Qu.: 792.0   3rd Qu.: 6312.9   3rd Qu.:11727.5  
 Max.   :22604.0   Max.   :1285.5   Max.   :18328.5   Max.   :53160.0  
    Disp_Inc           RORP            ROREmp                geometry 
 Min.   : 11954   Min.   :0.2357   Min.   :0.4545   POLYGON      :88  
 1st Qu.: 14966   1st Qu.:0.5968   1st Qu.:0.7565   epsg:3414    : 0  
 Median : 18542   Median :0.6517   Median :0.8300   +proj=tmer...: 0  
 Mean   : 26133   Mean   :0.6298   Mean   :0.8037                     
 3rd Qu.: 21774   3rd Qu.:0.6850   3rd Qu.:0.8653                     
 Max.   :183252   Max.   :0.7606   Max.   :0.9179                     </code></pre>
</div>
</div>
<p>Now we can make a basemap:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Hands-on_Ex04_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To see the GDPPC distribution on a map:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Hands-on_Ex04_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="computing-contiguity-spatial-weights" class="level1">
<h1>Computing Contiguity Spatial Weights</h1>
<p>We will compute the contiguity spatial weight matrice using the poly2nb() from spdep package</p>
<p>This function builds a neighbour list based on regions with contiguous boundaries (they are in contact with one or more boundary points, like North-East region in Singapore being contiguous with the North and East region)</p>
<section id="queen-based" class="level2">
<h2 class="anchored" data-anchor-id="queen-based">QUEEN Based</h2>
<p>the term QUEEN refers to a queen in chess, which can move to any points that are in contact, be it horizontal, vertical, or even diagonal. This means that in our computation, any region that is in contact is considered a neighbor, even if there is only a single point of contact between those regions.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 88 
Number of nonzero links: 448 
Percentage nonzero weights: 5.785124 
Average number of links: 5.090909 
Link number distribution:

 1  2  3  4  5  6  7  8  9 11 
 2  2 12 16 24 14 11  4  2  1 
2 least connected regions:
30 65 with 1 link
1 most connected region:
85 with 11 links</code></pre>
</div>
</div>
<p>The summary shows that out of 88 area units in Hunan, with the most connected unit having 11 neighbours.</p>
<p>To access the name of the county of the first polygon:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Anxiang"</code></pre>
</div>
</div>
<p>Let’s see the neighbors of the first polygon in the object</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2  3  4 57 85</code></pre>
</div>
</div>
<p>The code chunk above returns the index of the neighbours of the first polygon in the object. To get the name of the regions, use the code chunk below</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Hanshou" "Jinshi"  "Li"      "Nan"     "Taoyuan"</code></pre>
</div>
</div>
<p>The code chunk below is used to retrieve the GDPPC of the neighbours of the first polygon</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20981 34592 24473 21311 22879</code></pre>
</div>
</div>
<p>Use str() to display the complete weight matrix</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>List of 88
 $ : int [1:5] 2 3 4 57 85
 $ : int [1:5] 1 57 58 78 85
 $ : int [1:4] 1 4 5 85
 $ : int [1:4] 1 3 5 6
 $ : int [1:4] 3 4 6 85
 $ : int [1:5] 4 5 69 75 85
 $ : int [1:4] 67 71 74 84
 $ : int [1:7] 9 46 47 56 78 80 86
 $ : int [1:6] 8 66 68 78 84 86
 $ : int [1:8] 16 17 19 20 22 70 72 73
 $ : int [1:3] 14 17 72
 $ : int [1:5] 13 60 61 63 83
 $ : int [1:4] 12 15 60 83
 $ : int [1:3] 11 15 17
 $ : int [1:4] 13 14 17 83
 $ : int [1:5] 10 17 22 72 83
 $ : int [1:7] 10 11 14 15 16 72 83
 $ : int [1:5] 20 22 23 77 83
 $ : int [1:6] 10 20 21 73 74 86
 $ : int [1:7] 10 18 19 21 22 23 82
 $ : int [1:5] 19 20 35 82 86
 $ : int [1:5] 10 16 18 20 83
 $ : int [1:7] 18 20 38 41 77 79 82
 $ : int [1:5] 25 28 31 32 54
 $ : int [1:5] 24 28 31 33 81
 $ : int [1:4] 27 33 42 81
 $ : int [1:3] 26 29 42
 $ : int [1:5] 24 25 33 49 54
 $ : int [1:3] 27 37 42
 $ : int 33
 $ : int [1:8] 24 25 32 36 39 40 56 81
 $ : int [1:8] 24 31 50 54 55 56 75 85
 $ : int [1:5] 25 26 28 30 81
 $ : int [1:3] 36 45 80
 $ : int [1:6] 21 41 47 80 82 86
 $ : int [1:6] 31 34 40 45 56 80
 $ : int [1:4] 29 42 43 44
 $ : int [1:4] 23 44 77 79
 $ : int [1:5] 31 40 42 43 81
 $ : int [1:6] 31 36 39 43 45 79
 $ : int [1:6] 23 35 45 79 80 82
 $ : int [1:7] 26 27 29 37 39 43 81
 $ : int [1:6] 37 39 40 42 44 79
 $ : int [1:4] 37 38 43 79
 $ : int [1:6] 34 36 40 41 79 80
 $ : int [1:3] 8 47 86
 $ : int [1:5] 8 35 46 80 86
 $ : int [1:5] 50 51 52 53 55
 $ : int [1:4] 28 51 52 54
 $ : int [1:5] 32 48 52 54 55
 $ : int [1:3] 48 49 52
 $ : int [1:5] 48 49 50 51 54
 $ : int [1:3] 48 55 75
 $ : int [1:6] 24 28 32 49 50 52
 $ : int [1:5] 32 48 50 53 75
 $ : int [1:7] 8 31 32 36 78 80 85
 $ : int [1:6] 1 2 58 64 76 85
 $ : int [1:5] 2 57 68 76 78
 $ : int [1:4] 60 61 87 88
 $ : int [1:4] 12 13 59 61
 $ : int [1:7] 12 59 60 62 63 77 87
 $ : int [1:3] 61 77 87
 $ : int [1:4] 12 61 77 83
 $ : int [1:2] 57 76
 $ : int 76
 $ : int [1:5] 9 67 68 76 84
 $ : int [1:4] 7 66 76 84
 $ : int [1:5] 9 58 66 76 78
 $ : int [1:3] 6 75 85
 $ : int [1:3] 10 72 73
 $ : int [1:3] 7 73 74
 $ : int [1:5] 10 11 16 17 70
 $ : int [1:5] 10 19 70 71 74
 $ : int [1:6] 7 19 71 73 84 86
 $ : int [1:6] 6 32 53 55 69 85
 $ : int [1:7] 57 58 64 65 66 67 68
 $ : int [1:7] 18 23 38 61 62 63 83
 $ : int [1:7] 2 8 9 56 58 68 85
 $ : int [1:7] 23 38 40 41 43 44 45
 $ : int [1:8] 8 34 35 36 41 45 47 56
 $ : int [1:6] 25 26 31 33 39 42
 $ : int [1:5] 20 21 23 35 41
 $ : int [1:9] 12 13 15 16 17 18 22 63 77
 $ : int [1:6] 7 9 66 67 74 86
 $ : int [1:11] 1 2 3 5 6 32 56 57 69 75 ...
 $ : int [1:9] 8 9 19 21 35 46 47 74 84
 $ : int [1:4] 59 61 62 88
 $ : int [1:2] 59 87
 - attr(*, "class")= chr "nb"
 - attr(*, "region.id")= chr [1:88] "1" "2" "3" "4" ...
 - attr(*, "call")= language poly2nb(pl = hunan, queen = TRUE)
 - attr(*, "type")= chr "queen"
 - attr(*, "sym")= logi TRUE</code></pre>
</div>
</div>
</section>
<section id="rook-based" class="level2">
<h2 class="anchored" data-anchor-id="rook-based">ROOK Based</h2>
<p>Unlike the queen, a rook can only move vertically or horizontally, with no diagonal movement. In this case, using a ROOK based (queen=FALSE) means that regions that only have a single point of contact is not considered a neighbor.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 88 
Number of nonzero links: 440 
Percentage nonzero weights: 5.681818 
Average number of links: 5 
Link number distribution:

 1  2  3  4  5  6  7  8  9 10 
 2  2 12 20 21 14 11  3  2  1 
2 least connected regions:
30 65 with 1 link
1 most connected region:
85 with 10 links</code></pre>
</div>
</div>
<p>Here you can see that unlike the queen version, the rook method shows 85 regions with 10 links</p>
<p>Checking the names of the neighbours of the first polygon</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Jinshi"  "Li"      "Nan"     "Taoyuan"</code></pre>
</div>
</div>
</section>
<section id="visualising-contiguity-weights" class="level2">
<h2 class="anchored" data-anchor-id="visualising-contiguity-weights">Visualising Contiguity Weights</h2>
<p>A connectivity graph needs a point and displays a line to each neighboring point. As we are working with polygons in this exercise, we need to get points to draw the line. The most typical method is polygon centroids.</p>
<p>We will need points to associate with each polygon before we can make our connectivity graph. It will be a little more complicated than just running st_centroid on the sf object: us.bound. We need the coordinates in a separate data frame for this to work. To do this we will use a mapping function. The mapping function applies a given function to each element of a vector and returns a vector of the same length. Our input vector will be the geometry column of us.bound. Our function will be st_centroid. We will be using map_dbl variation of map from the purrr package.</p>
<p>To get our longitude values we map the st_centroid function over the geometry column of us.bound and access the longitude value through double bracket notation [[]] and 1. This allows us to get only the longitude, which is the first value in each centroid.</p>
<p>We do the same for latitude with one key difference. We access the second value per each centroid with [[2]].</p>
<p>Now we combine it with cbind</p>
<p>Check the first few observations</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>     longitude latitude
[1,]  836662.0  3175038
[2,]  829886.4  3109750
[3,]  810959.7  3176299
[4,]  790539.4  3205555
[5,]  783717.8  3176834</code></pre>
</div>
</div>
<section id="plotting-queen-contiguity-based-neighbours-map" class="level3">
<h3 class="anchored" data-anchor-id="plotting-queen-contiguity-based-neighbours-map">Plotting Queen contiguity based neighbours map</h3>
<div class="cell">
<div class="cell-output-display">
<p><img src="Hands-on_Ex04_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="plotting-rook-contiguity-based-neighbours-map" class="level3">
<h3 class="anchored" data-anchor-id="plotting-rook-contiguity-based-neighbours-map">Plotting Rook contiguity based neighbours map</h3>
<div class="cell">
<div class="cell-output-display">
<p><img src="Hands-on_Ex04_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="computing-distance-based-neighbours" class="level1">
<h1>Computing Distance Based Neighbours</h1>
<p>To compute distance based neighbours, we can use dnearneigh() from the spdep package. This function identifies neighbours of region points by Euclidean distance with a distance band with lower d1= and upper d2= bounds controlled by the bounds= argument</p>
<section id="identifying-cut-off-distance" class="level2">
<h2 class="anchored" data-anchor-id="identifying-cut-off-distance">Identifying cut-off distance</h2>
<p>Steps: 1. Return a matrix with indices of points that are k nearest neighbours using knearneigh() 2. Convert the knn object from knearneigh() to a list of class nb with a lost of integer vectors containing neighbour region id using knn2nb() 3. Return length of neigbour relationship edges using nbdists() 4. Remove the list structure of returned object using unlist()</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   2251    6033    9870    9904   13825   17201 </code></pre>
</div>
</div>
</section>
<section id="computing-fixed-distance-weight-matrix" class="level2">
<h2 class="anchored" data-anchor-id="computing-fixed-distance-weight-matrix">Computing Fixed Distance Weight Matrix</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 88 
Number of nonzero links: 0 
Percentage nonzero weights: 0 
Average number of links: 0 
88 regions with no links:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27
28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51
52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75
76 77 78 79 80 81 82 83 84 85 86 87 88
88 disjoint connected subgraphs</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>List of 88
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 $ : int 0
 - attr(*, "class")= chr "nb"
 - attr(*, "region.id")= chr [1:88] "1" "2" "3" "4" ...
 - attr(*, "call")= language dnearneigh(x = coords, d1 = 0, d2 = 62, longlat = TRUE)
 - attr(*, "dnn")= num [1:2] 0 62
 - attr(*, "bounds")= chr [1:2] "GE" "LE"
 - attr(*, "nbtype")= chr "distance"
 - attr(*, "sym")= logi TRUE</code></pre>
</div>
</div>
<section id="plotting-fixed-distance-weight-matrix" class="level3">
<h3 class="anchored" data-anchor-id="plotting-fixed-distance-weight-matrix">Plotting Fixed Distance Weight Matrix</h3>
<div class="cell">
<div class="cell-output-display">
<p><img src="Hands-on_Ex04_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The red lines show the links of 1st nearest neighbours and the black lines show the links of neighbours within the cut-off distance of 62km.</p>
<p>Alternatively, we can plot both of them next to each other by using the code chunk below.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Hands-on_Ex04_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="computing-adaptive-distance-weight-matrix" class="level2">
<h2 class="anchored" data-anchor-id="computing-adaptive-distance-weight-matrix">Computing Adaptive Distance Weight Matrix</h2>
<p>Adaptive distance weight matrix takes into account that less densely settled areas (e.g.&nbsp;villages, countryside, etc) tend to have less neighbours, and more densely settled areas (big cities) tends to have more neighbours. Thus, we can use K-Nearest Neighbour to control the number of neighbours directly when we calculate the weight matrix</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 88 
Number of nonzero links: 528 
Percentage nonzero weights: 6.818182 
Average number of links: 6 
Non-symmetric neighbours list</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 88
 $ : int [1:6] 2 3 4 5 57 64
 $ : int [1:6] 1 3 57 58 78 85
 $ : int [1:6] 1 2 4 5 57 85
 $ : int [1:6] 1 3 5 6 57 69
 $ : int [1:6] 1 3 4 6 69 85
 $ : int [1:6] 3 4 5 69 75 85
 $ : int [1:6] 9 66 67 71 74 84
 $ : int [1:6] 9 46 47 78 80 86
 $ : int [1:6] 8 46 66 68 78 84
 $ : int [1:6] 16 19 22 70 72 73
 $ : int [1:6] 10 14 16 17 70 72
 $ : int [1:6] 13 15 60 61 63 83
 $ : int [1:6] 12 15 60 61 63 83
 $ : int [1:6] 11 15 16 17 72 83
 $ : int [1:6] 12 13 14 17 60 83
 $ : int [1:6] 10 11 17 22 72 83
 $ : int [1:6] 10 11 14 16 72 83
 $ : int [1:6] 20 22 23 63 77 83
 $ : int [1:6] 10 20 21 73 74 82
 $ : int [1:6] 18 19 21 22 23 82
 $ : int [1:6] 19 20 35 74 82 86
 $ : int [1:6] 10 16 18 19 20 83
 $ : int [1:6] 18 20 41 77 79 82
 $ : int [1:6] 25 28 31 52 54 81
 $ : int [1:6] 24 28 31 33 39 81
 $ : int [1:6] 25 27 30 33 42 81
 $ : int [1:6] 26 29 30 37 42 81
 $ : int [1:6] 24 25 33 49 52 54
 $ : int [1:6] 26 27 37 42 43 81
 $ : int [1:6] 26 27 28 33 49 81
 $ : int [1:6] 24 25 36 39 40 54
 $ : int [1:6] 24 31 50 54 55 56
 $ : int [1:6] 25 26 28 30 49 81
 $ : int [1:6] 36 40 41 45 56 80
 $ : int [1:6] 21 41 46 47 80 82
 $ : int [1:6] 31 34 40 45 56 80
 $ : int [1:6] 26 27 29 42 43 44
 $ : int [1:6] 23 43 44 62 77 79
 $ : int [1:6] 25 40 42 43 44 81
 $ : int [1:6] 31 34 36 39 45 79
 $ : int [1:6] 23 35 45 79 80 82
 $ : int [1:6] 26 27 37 39 43 81
 $ : int [1:6] 37 39 40 42 44 79
 $ : int [1:6] 37 38 39 42 43 79
 $ : int [1:6] 34 36 40 41 79 80
 $ : int [1:6] 8 9 35 47 74 86
 $ : int [1:6] 8 21 35 46 80 86
 $ : int [1:6] 50 51 52 53 54 55
 $ : int [1:6] 28 33 48 51 52 54
 $ : int [1:6] 32 48 51 52 54 55
 $ : int [1:6] 28 48 49 50 52 54
 $ : int [1:6] 28 48 49 50 51 54
 $ : int [1:6] 48 50 51 52 55 75
 $ : int [1:6] 24 28 49 50 51 52
 $ : int [1:6] 32 48 50 52 53 75
 $ : int [1:6] 32 34 36 78 80 85
 $ : int [1:6] 1 2 3 58 64 68
 $ : int [1:6] 2 57 64 66 68 78
 $ : int [1:6] 12 13 60 61 87 88
 $ : int [1:6] 12 13 59 61 63 87
 $ : int [1:6] 12 13 60 62 63 87
 $ : int [1:6] 12 38 61 63 77 87
 $ : int [1:6] 12 18 60 61 62 83
 $ : int [1:6] 1 3 57 58 65 76
 $ : int [1:6] 57 58 64 66 67 76
 $ : int [1:6] 9 58 67 68 76 84
 $ : int [1:6] 7 65 66 68 76 84
 $ : int [1:6] 9 57 58 66 78 84
 $ : int [1:6] 3 4 5 6 75 85
 $ : int [1:6] 10 16 19 22 72 73
 $ : int [1:6] 7 19 73 74 84 86
 $ : int [1:6] 10 11 16 17 22 70
 $ : int [1:6] 10 19 21 70 71 74
 $ : int [1:6] 19 21 46 71 73 86
 $ : int [1:6] 6 32 50 53 55 69
 $ : int [1:6] 57 58 64 65 66 68
 $ : int [1:6] 18 23 38 61 62 63
 $ : int [1:6] 2 8 9 46 58 68
 $ : int [1:6] 23 38 40 41 43 45
 $ : int [1:6] 34 35 36 41 45 47
 $ : int [1:6] 25 26 28 33 39 42
 $ : int [1:6] 19 20 21 23 35 41
 $ : int [1:6] 12 13 15 16 22 63
 $ : int [1:6] 7 9 66 67 68 74
 $ : int [1:6] 1 2 3 5 56 69
 $ : int [1:6] 8 21 46 47 71 74
 $ : int [1:6] 59 60 61 62 63 88
 $ : int [1:6] 59 60 61 62 63 87
 - attr(*, "region.id")= chr [1:88] "1" "2" "3" "4" ...
 - attr(*, "call")= language knearneigh(x = coords, k = 6)
 - attr(*, "sym")= logi FALSE
 - attr(*, "type")= chr "knn"
 - attr(*, "knn-k")= num 6
 - attr(*, "class")= chr "nb"</code></pre>
</div>
</div>
<section id="plotting-adaptive-distance-weight-matrix" class="level3">
<h3 class="anchored" data-anchor-id="plotting-adaptive-distance-weight-matrix">Plotting Adaptive Distance Weight Matrix</h3>
<div class="cell">
<div class="cell-output-display">
<p><img src="Hands-on_Ex04_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="weights-based-on-idw" class="level1">
<h1>Weights Based on IDW</h1>
<p>We will learn how to derive a spatial weight matrix based on inverted distance method with the nbdists() from spdep</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 7.791839e-05 1.721638e-04 1.009428e-04 1.616320e-04 9.865571e-05

[[2]]
[1] 7.791839e-05 6.958731e-05 1.544668e-04 6.703714e-05 1.536833e-04

[[3]]
[1] 1.721638e-04 1.307205e-04 1.297893e-04 7.767408e-05

[[4]]
[1] 0.0001009428 0.0001307205 0.0001119508 0.0001341177

[[5]]
[1] 0.0001297893 0.0001119508 0.0004038569 0.0001325193

[[6]]
[1] 1.341177e-04 4.038569e-04 1.003691e-04 7.288887e-05 1.957595e-04

[[7]]
[1] 3.452679e-04 6.753213e-05 5.368105e-05 6.089031e-05

[[8]]
[1] 6.494665e-05 8.680182e-05 6.490639e-05 1.900628e-04 2.660811e-04
[6] 1.263392e-04 1.430096e-04

[[9]]
[1] 6.494665e-05 1.070698e-04 5.676149e-04 6.876825e-05 4.298251e-04
[6] 5.724201e-05

[[10]]
[1] 1.301017e-04 6.727165e-05 9.497114e-05 9.019791e-05 6.415645e-05
[6] 1.815975e-04 9.721803e-05 1.058223e-04

[[11]]
[1] 6.203439e-05 2.231720e-04 1.073796e-04

[[12]]
[1] 1.949926e-04 7.579309e-04 2.021065e-04 6.673075e-05 6.512038e-05

[[13]]
[1] 1.949926e-04 6.741405e-05 2.597598e-04 8.920467e-05

[[14]]
[1] 6.203439e-05 1.060879e-04 6.890720e-05

[[15]]
[1] 6.741405e-05 1.060879e-04 1.348462e-04 1.387176e-04

[[16]]
[1] 1.301017e-04 8.104922e-05 7.856684e-05 2.384560e-04 6.636424e-05

[[17]]
[1] 6.727165e-05 2.231720e-04 6.890720e-05 1.348462e-04 8.104922e-05
[6] 7.791460e-05 3.525841e-04

[[18]]
[1] 9.699245e-05 1.396843e-04 9.582396e-05 1.267046e-04 2.289711e-04

[[19]]
[1] 9.497114e-05 6.471286e-04 6.632805e-05 5.663656e-05 5.320737e-05
[6] 2.546277e-04

[[20]]
[1] 9.019791e-05 9.699245e-05 6.471286e-04 6.016411e-05 1.298119e-04
[6] 1.806820e-04 6.183027e-05

[[21]]
[1] 6.632805e-05 6.016411e-05 9.038953e-05 1.426690e-04 7.922629e-05

[[22]]
[1] 6.415645e-05 7.856684e-05 1.396843e-04 1.298119e-04 1.123149e-04

[[23]]
[1] 9.582396e-05 1.806820e-04 1.682909e-04 5.860711e-05 8.500822e-05
[6] 6.117774e-05 5.562289e-05

[[24]]
[1] 7.332703e-05 1.479546e-04 1.983755e-04 9.741990e-05 5.152122e-05

[[25]]
[1] 7.332703e-05 1.047306e-04 5.579271e-05 9.042384e-05 6.793958e-05

[[26]]
[1] 1.585020e-04 9.933260e-05 8.276446e-05 1.274438e-04

[[27]]
[1] 1.585020e-04 5.813463e-05 5.454357e-05

[[28]]
[1] 1.479546e-04 1.047306e-04 3.901673e-04 1.581170e-04 7.231409e-05

[[29]]
[1] 5.813463e-05 6.989923e-05 2.226503e-04

[[30]]
[1] 7.354566e-05

[[31]]
[1] 1.983755e-04 5.579271e-05 9.628829e-05 6.679962e-05 1.785969e-04
[6] 1.166502e-04 6.881956e-05 2.550577e-04

[[32]]
[1] 9.741990e-05 9.628829e-05 9.381661e-05 1.093537e-04 1.216907e-04
[6] 1.113062e-04 7.096933e-05 6.157035e-05

[[33]]
[1] 9.042384e-05 9.933260e-05 3.901673e-04 7.354566e-05 2.163251e-04

[[34]]
[1] 8.072159e-05 1.078923e-04 4.076026e-04

[[35]]
[1] 9.038953e-05 7.632407e-05 7.409778e-05 5.297512e-05 7.198712e-05
[6] 2.387209e-04

[[36]]
[1] 6.679962e-05 8.072159e-05 6.957842e-05 1.000476e-04 4.443384e-04
[6] 9.117710e-05

[[37]]
[1] 6.989923e-05 7.421694e-05 6.769793e-05 7.580369e-05

[[38]]
[1] 1.682909e-04 1.651796e-04 7.015278e-05 7.391305e-05

[[39]]
[1] 1.785969e-04 2.612286e-04 1.201259e-04 7.606105e-05 4.886780e-04

[[40]]
[1] 1.166502e-04 6.957842e-05 2.612286e-04 9.158186e-05 8.654393e-05
[6] 1.722293e-04

[[41]]
[1] 5.860711e-05 7.632407e-05 8.030930e-05 2.280435e-04 1.285654e-04
[6] 3.167321e-04

[[42]]
[1] 8.276446e-05 5.454357e-05 2.226503e-04 7.421694e-05 1.201259e-04
[6] 1.413227e-04 9.935576e-05

[[43]]
[1] 6.769793e-05 7.606105e-05 9.158186e-05 1.413227e-04 1.569693e-04
[6] 7.012204e-05

[[44]]
[1] 7.580369e-05 1.651796e-04 1.569693e-04 5.208480e-05

[[45]]
[1] 1.078923e-04 1.000476e-04 8.654393e-05 8.030930e-05 1.099874e-04
[6] 1.394455e-04

[[46]]
[1] 8.680182e-05 9.587405e-05 9.693208e-05

[[47]]
[1] 6.490639e-05 7.409778e-05 9.587405e-05 1.332275e-04 5.836378e-05

[[48]]
[1] 1.905966e-04 2.843972e-04 5.958347e-05 1.124390e-04 7.819470e-05

[[49]]
[1] 1.581170e-04 5.838679e-05 1.608393e-04 5.083163e-05

[[50]]
[1] 9.381661e-05 1.905966e-04 7.725057e-05 5.518199e-04 5.952665e-05

[[51]]
[1] 2.843972e-04 5.838679e-05 7.526662e-05

[[52]]
[1] 5.958347e-05 1.608393e-04 7.725057e-05 7.526662e-05 7.233491e-05

[[53]]
[1] 0.0001124390 0.0001675007 0.0000837843

[[54]]
[1] 5.152122e-05 7.231409e-05 1.093537e-04 5.083163e-05 5.518199e-04
[6] 7.233491e-05

[[55]]
[1] 1.216907e-04 7.819470e-05 5.952665e-05 1.675007e-04 1.646653e-04

[[56]]
[1] 1.900628e-04 6.881956e-05 1.113062e-04 4.443384e-04 1.879574e-04
[6] 7.666818e-05 9.278936e-05

[[57]]
[1] 1.616320e-04 6.958731e-05 1.230543e-04 1.236761e-04 9.555922e-05
[6] 6.131073e-05

[[58]]
[1] 1.544668e-04 1.230543e-04 1.581070e-04 3.340680e-04 9.278395e-05

[[59]]
[1] 6.723748e-05 6.263676e-05 2.418702e-04 3.457775e-04

[[60]]
[1] 7.579309e-04 2.597598e-04 6.723748e-05 1.870313e-04

[[61]]
[1] 2.021065e-04 6.263676e-05 1.870313e-04 2.533465e-04 7.946158e-05
[6] 7.962004e-05 7.432225e-05

[[62]]
[1] 2.533465e-04 9.759112e-05 5.748614e-05

[[63]]
[1] 6.673075e-05 7.946158e-05 6.721072e-05 1.229992e-04

[[64]]
[1] 1.236761e-04 6.117029e-05

[[65]]
[1] 0.0001013129

[[66]]
[1] 1.070698e-04 9.275137e-05 1.098306e-04 1.013612e-04 1.323075e-04

[[67]]
[1] 3.452679e-04 9.275137e-05 5.247586e-05 5.897665e-05

[[68]]
[1] 5.676149e-04 1.581070e-04 1.098306e-04 2.757614e-04 6.560363e-05

[[69]]
[1] 0.0001003691 0.0001495726 0.0001099150

[[70]]
[1] 1.815975e-04 1.990761e-04 6.929686e-05

[[71]]
[1] 6.753213e-05 1.527752e-04 1.693083e-04

[[72]]
[1] 9.721803e-05 1.073796e-04 2.384560e-04 7.791460e-05 1.990761e-04

[[73]]
[1] 1.058223e-04 5.663656e-05 6.929686e-05 1.527752e-04 4.036335e-04

[[74]]
[1] 5.368105e-05 5.320737e-05 1.693083e-04 4.036335e-04 4.196948e-04
[6] 5.934177e-05

[[75]]
[1] 7.288887e-05 7.096933e-05 8.378430e-05 1.646653e-04 1.495726e-04
[6] 1.110417e-04

[[76]]
[1] 9.555922e-05 3.340680e-04 6.117029e-05 1.013129e-04 1.013612e-04
[6] 5.247586e-05 2.757614e-04

[[77]]
[1] 1.267046e-04 8.500822e-05 7.015278e-05 7.962004e-05 9.759112e-05
[6] 6.721072e-05 9.114382e-05

[[78]]
[1] 6.703714e-05 2.660811e-04 6.876825e-05 1.879574e-04 9.278395e-05
[6] 6.560363e-05 9.909262e-05

[[79]]
[1] 6.117774e-05 7.391305e-05 1.722293e-04 2.280435e-04 7.012204e-05
[6] 5.208480e-05 1.099874e-04

[[80]]
[1] 1.263392e-04 4.076026e-04 5.297512e-05 9.117710e-05 1.285654e-04
[6] 1.394455e-04 1.332275e-04 7.666818e-05

[[81]]
[1] 6.793958e-05 1.274438e-04 2.550577e-04 2.163251e-04 4.886780e-04
[6] 9.935576e-05

[[82]]
[1] 6.183027e-05 1.426690e-04 5.562289e-05 7.198712e-05 3.167321e-04

[[83]]
[1] 6.512038e-05 8.920467e-05 1.387176e-04 6.636424e-05 3.525841e-04
[6] 2.289711e-04 1.123149e-04 1.229992e-04 9.114382e-05

[[84]]
[1] 6.089031e-05 4.298251e-04 1.323075e-04 5.897665e-05 4.196948e-04
[6] 6.517695e-05

[[85]]
 [1] 9.865571e-05 1.536833e-04 7.767408e-05 1.325193e-04 1.957595e-04
 [6] 6.157035e-05 9.278936e-05 6.131073e-05 1.099150e-04 1.110417e-04
[11] 9.909262e-05

[[86]]
[1] 1.430096e-04 5.724201e-05 2.546277e-04 7.922629e-05 2.387209e-04
[6] 9.693208e-05 5.836378e-05 5.934177e-05 6.517695e-05

[[87]]
[1] 2.418702e-04 7.432225e-05 5.748614e-05 3.655878e-04

[[88]]
[1] 0.0003457775 0.0003655878</code></pre>
</div>
</div>
<section id="row-standardised-weight-matrix" class="level2">
<h2 class="anchored" data-anchor-id="row-standardised-weight-matrix">Row-Standardised Weight Matrix</h2>
<p>Now, we assign weights to each neighboring polygon. The style=“W” argument refers to each neighboring polygon being assigned equal weight. This is accomplished by assigning the fraction 1/(#ofneighbors) to each neighboring county then summing the weighted income values. This way is the most intuitive way, but a huge drawback is that polygons along the edges of the study area will base their lagged values on fewer polygons thus potentially over- or under-estimating the true nature of the spatial autocorrelation in the data. Other more robust options are availabe, such as using style=“B”.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 88 
Number of nonzero links: 448 
Percentage nonzero weights: 5.785124 
Average number of links: 5.090909 

Weights style: W 
Weights constants summary:
   n   nn S0       S1       S2
W 88 7744 88 37.86334 365.9147</code></pre>
</div>
</div>
<p>zero.policy = TRUE allows for lists of non-neighbors. This should be used with caution since the user may not be aware of missing neighbors in their dataset</p>
<p>To see the weights of the first polygon’s eight neighbors type:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 0.2 0.2 0.2 0.2 0.2</code></pre>
</div>
</div>
<p>when R computes the average neighboring income values, each neighbor’s income will be multiplied by 0.2 before being tallied.</p>
<p>Compare it with the style=“B” below</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 88 
Number of nonzero links: 448 
Percentage nonzero weights: 5.785124 
Average number of links: 5.090909 

Weights style: B 
Weights constants summary:
   n   nn         S0           S1           S2
B 88 7744 0.06196579 2.782761e-05 0.0002075265</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 7.791839e-05 1.721638e-04 1.009428e-04 1.616320e-04 9.865571e-05</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
5.083e-05 7.015e-05 9.887e-05 1.383e-04 1.582e-04 7.579e-04 </code></pre>
</div>
</div>
</section>
</section>
<section id="application-of-spatial-weight-matrix" class="level1">
<h1>Application of Spatial Weight Matrix</h1>
<p>In this section, you will learn how to create four different spatial lagged variables, they are:</p>
<ol type="1">
<li>spatial lag with row-standardized weights,</li>
<li>spatial lag as a sum of neighbouring values,</li>
<li>spatial window average, and</li>
<li>spatial window sum.</li>
</ol>
<section id="spatial-lag-with-row-standardized-weights" class="level2">
<h2 class="anchored" data-anchor-id="spatial-lag-with-row-standardized-weights">Spatial Lag With Row-Standardized Weights</h2>
<p>Spatially lagged values here refers to average neighbor GDPPC value for each polygon.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] 24847.20 22724.80 24143.25 27737.50 27270.25 21248.80 43747.00 33582.71
 [9] 45651.17 32027.62 32671.00 20810.00 25711.50 30672.33 33457.75 31689.20
[17] 20269.00 23901.60 25126.17 21903.43 22718.60 25918.80 20307.00 20023.80
[25] 16576.80 18667.00 14394.67 19848.80 15516.33 20518.00 17572.00 15200.12
[33] 18413.80 14419.33 24094.50 22019.83 12923.50 14756.00 13869.80 12296.67
[41] 15775.17 14382.86 11566.33 13199.50 23412.00 39541.00 36186.60 16559.60
[49] 20772.50 19471.20 19827.33 15466.80 12925.67 18577.17 14943.00 24913.00
[57] 25093.00 24428.80 17003.00 21143.75 20435.00 17131.33 24569.75 23835.50
[65] 26360.00 47383.40 55157.75 37058.00 21546.67 23348.67 42323.67 28938.60
[73] 25880.80 47345.67 18711.33 29087.29 20748.29 35933.71 15439.71 29787.50
[81] 18145.00 21617.00 29203.89 41363.67 22259.09 44939.56 16902.00 16930.00</code></pre>
</div>
</div>
<p>Nowe we retrieve the GDPPC of these five countries</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20981 34592 24473 21311 22879</code></pre>
</div>
</div>
<p>Now we append the lag list to hunan data</p>
<p>Now let’s plot it to compare GDPPC and spatial lag GDPPC</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Hands-on_Ex04_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The spatial lag GDPPC is the weighted average of the neighboring region’s GDPPC. Essentially, When interpreting spatial lag with row-standardized weights, you are looking at how much the GDPPC of neighboring regions contributes to the GDPPC of a given region</p>
</section>
<section id="spatial-lag-as-sum-of-neighboring-values" class="level2">
<h2 class="anchored" data-anchor-id="spatial-lag-as-sum-of-neighboring-values">Spatial Lag As Sum of Neighboring Values</h2>
<p>We can calculate spatial lag as a sum of neighboring values by assigning binary weights.</p>
<p>First, we apply a value of 1 per each neighbor with lapply.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 88 
Number of nonzero links: 448 
Percentage nonzero weights: 5.785124 
Average number of links: 5.090909 

Weights style: B 
Weights constants summary:
   n   nn  S0  S1    S2
B 88 7744 448 896 10224</code></pre>
</div>
</div>
<p>After assigning the proper weights, e can use lag.listw to compute a lag variable from our weight and GDPPC</p>
<p>We can append the output to our hunan data.</p>
<p>Let’s compare the GDPPC with the lag sum</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Hands-on_Ex04_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="spatial-window-average" class="level2">
<h2 class="anchored" data-anchor-id="spatial-window-average">Spatial Window Average</h2>
<p>The spatial window average uses row-standardized weights and includes the diagonal element. To add the diagonal element, we can use include.self() from spdep</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1  2  3  4 57 85</code></pre>
</div>
</div>
<p>Now we obtain weights with nb2listw()</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 88 
Number of nonzero links: 536 
Percentage nonzero weights: 6.921488 
Average number of links: 6.090909 

Weights style: W 
Weights constants summary:
   n   nn S0       S1       S2
W 88 7744 88 30.90265 357.5308</code></pre>
</div>
</div>
<p>Next, we just need to create the lag variable</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] 24650.50 22434.17 26233.00 27084.60 26927.00 22230.17 47621.20 37160.12
 [9] 49224.71 29886.89 26627.50 22690.17 25366.40 25825.75 30329.00 32682.83
[17] 25948.62 23987.67 25463.14 21904.38 23127.50 25949.83 20018.75 19524.17
[25] 18955.00 17800.40 15883.00 18831.33 14832.50 17965.00 17159.89 16199.44
[33] 18764.50 26878.75 23188.86 20788.14 12365.20 15985.00 13764.83 11907.43
[41] 17128.14 14593.62 11644.29 12706.00 21712.29 43548.25 35049.00 16226.83
[49] 19294.40 18156.00 19954.75 18145.17 12132.75 18419.29 14050.83 23619.75
[57] 24552.71 24733.67 16762.60 20932.60 19467.75 18334.00 22541.00 26028.00
[65] 29128.50 46569.00 47576.60 36545.50 20838.50 22531.00 42115.50 27619.00
[73] 27611.33 44523.29 18127.43 28746.38 20734.50 33880.62 14716.38 28516.22
[81] 18086.14 21244.50 29568.80 48119.71 22310.75 43151.60 17133.40 17009.33</code></pre>
</div>
</div>
<p>And convert it into a data.frame and combine it with the hunan data</p>
<p>Compare the lag GDPPC with the lag_window_average GDPPC with the kable() function from knitr</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 27%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">County</th>
<th style="text-align: right;">lag GDPPC</th>
<th style="text-align: right;">lag_window_avg GDPPC</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Anxiang</td>
<td style="text-align: right;">24847.20</td>
<td style="text-align: right;">24650.50</td>
<td style="text-align: left;">POLYGON ((825339.4 3209148,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hanshou</td>
<td style="text-align: right;">22724.80</td>
<td style="text-align: right;">22434.17</td>
<td style="text-align: left;">POLYGON ((846673.4 3139165,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jinshi</td>
<td style="text-align: right;">24143.25</td>
<td style="text-align: right;">26233.00</td>
<td style="text-align: left;">POLYGON ((810038.7 3190827,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Li</td>
<td style="text-align: right;">27737.50</td>
<td style="text-align: right;">27084.60</td>
<td style="text-align: left;">POLYGON ((756935.9 3225838,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Linli</td>
<td style="text-align: right;">27270.25</td>
<td style="text-align: right;">26927.00</td>
<td style="text-align: left;">POLYGON ((783475.6 3207079,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Shimen</td>
<td style="text-align: right;">21248.80</td>
<td style="text-align: right;">22230.17</td>
<td style="text-align: left;">POLYGON ((708206.5 3241744,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Liuyang</td>
<td style="text-align: right;">43747.00</td>
<td style="text-align: right;">47621.20</td>
<td style="text-align: left;">POLYGON ((1024633 3091569, …</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ningxiang</td>
<td style="text-align: right;">33582.71</td>
<td style="text-align: right;">37160.12</td>
<td style="text-align: left;">POLYGON ((900741.8 3060845,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wangcheng</td>
<td style="text-align: right;">45651.17</td>
<td style="text-align: right;">49224.71</td>
<td style="text-align: left;">POLYGON ((906766.3 3077439,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Anren</td>
<td style="text-align: right;">32027.62</td>
<td style="text-align: right;">29886.89</td>
<td style="text-align: left;">POLYGON ((959144.5 2890585,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Guidong</td>
<td style="text-align: right;">32671.00</td>
<td style="text-align: right;">26627.50</td>
<td style="text-align: left;">POLYGON ((1065564 2828411, …</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jiahe</td>
<td style="text-align: right;">20810.00</td>
<td style="text-align: right;">22690.17</td>
<td style="text-align: left;">POLYGON ((893838.3 2764449,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Linwu</td>
<td style="text-align: right;">25711.50</td>
<td style="text-align: right;">25366.40</td>
<td style="text-align: left;">POLYGON ((910317.1 2744004,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rucheng</td>
<td style="text-align: right;">30672.33</td>
<td style="text-align: right;">25825.75</td>
<td style="text-align: left;">POLYGON ((1017476 2788033, …</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Yizhang</td>
<td style="text-align: right;">33457.75</td>
<td style="text-align: right;">30329.00</td>
<td style="text-align: left;">POLYGON ((977190.9 2763499,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yongxing</td>
<td style="text-align: right;">31689.20</td>
<td style="text-align: right;">32682.83</td>
<td style="text-align: left;">POLYGON ((976718.2 2845964,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Zixing</td>
<td style="text-align: right;">20269.00</td>
<td style="text-align: right;">25948.62</td>
<td style="text-align: left;">POLYGON ((1020609 2820527, …</td>
</tr>
<tr class="even">
<td style="text-align: left;">Changning</td>
<td style="text-align: right;">23901.60</td>
<td style="text-align: right;">23987.67</td>
<td style="text-align: left;">POLYGON ((904677 2861393, 9…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hengdong</td>
<td style="text-align: right;">25126.17</td>
<td style="text-align: right;">25463.14</td>
<td style="text-align: left;">POLYGON ((948954.5 2932803,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hengnan</td>
<td style="text-align: right;">21903.43</td>
<td style="text-align: right;">21904.38</td>
<td style="text-align: left;">POLYGON ((916277.6 2904767,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hengshan</td>
<td style="text-align: right;">22718.60</td>
<td style="text-align: right;">23127.50</td>
<td style="text-align: left;">POLYGON ((897149.3 2958067,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Leiyang</td>
<td style="text-align: right;">25918.80</td>
<td style="text-align: right;">25949.83</td>
<td style="text-align: left;">POLYGON ((942592.9 2874262,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Qidong</td>
<td style="text-align: right;">20307.00</td>
<td style="text-align: right;">20018.75</td>
<td style="text-align: left;">POLYGON ((818150.6 2904520,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chenxi</td>
<td style="text-align: right;">20023.80</td>
<td style="text-align: right;">19524.17</td>
<td style="text-align: left;">POLYGON ((659836.5 3027008,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Zhongfang</td>
<td style="text-align: right;">16576.80</td>
<td style="text-align: right;">18955.00</td>
<td style="text-align: left;">POLYGON ((631117.1 2970989,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Huitong</td>
<td style="text-align: right;">18667.00</td>
<td style="text-align: right;">17800.40</td>
<td style="text-align: left;">POLYGON ((634422.1 2901669,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jingzhou</td>
<td style="text-align: right;">14394.67</td>
<td style="text-align: right;">15883.00</td>
<td style="text-align: left;">POLYGON ((623976.4 2862538,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mayang</td>
<td style="text-align: right;">19848.80</td>
<td style="text-align: right;">18831.33</td>
<td style="text-align: left;">POLYGON ((615109.7 2998224,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tongdao</td>
<td style="text-align: right;">15516.33</td>
<td style="text-align: right;">14832.50</td>
<td style="text-align: left;">POLYGON ((636593.9 2830511,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Xinhuang</td>
<td style="text-align: right;">20518.00</td>
<td style="text-align: right;">17965.00</td>
<td style="text-align: left;">POLYGON ((561722.2 2935313,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Xupu</td>
<td style="text-align: right;">17572.00</td>
<td style="text-align: right;">17159.89</td>
<td style="text-align: left;">POLYGON ((704263.2 3039179,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yuanling</td>
<td style="text-align: right;">15200.12</td>
<td style="text-align: right;">16199.44</td>
<td style="text-align: left;">POLYGON ((723892.4 3117846,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Zhijiang</td>
<td style="text-align: right;">18413.80</td>
<td style="text-align: right;">18764.50</td>
<td style="text-align: left;">POLYGON ((625721.6 2957129,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lengshuijiang</td>
<td style="text-align: right;">14419.33</td>
<td style="text-align: right;">26878.75</td>
<td style="text-align: left;">POLYGON ((787713 2989441, 7…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Shuangfeng</td>
<td style="text-align: right;">24094.50</td>
<td style="text-align: right;">23188.86</td>
<td style="text-align: left;">POLYGON ((861128.6 2981916,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Xinhua</td>
<td style="text-align: right;">22019.83</td>
<td style="text-align: right;">20788.14</td>
<td style="text-align: left;">POLYGON ((765661.4 3030736,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chengbu</td>
<td style="text-align: right;">12923.50</td>
<td style="text-align: right;">12365.20</td>
<td style="text-align: left;">POLYGON ((686942.1 2858390,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dongan</td>
<td style="text-align: right;">14756.00</td>
<td style="text-align: right;">15985.00</td>
<td style="text-align: left;">POLYGON ((786516 2883527, 7…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dongkou</td>
<td style="text-align: right;">13869.80</td>
<td style="text-align: right;">13764.83</td>
<td style="text-align: left;">POLYGON ((704480.6 2935185,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Longhui</td>
<td style="text-align: right;">12296.67</td>
<td style="text-align: right;">11907.43</td>
<td style="text-align: left;">POLYGON ((734695.4 2968915,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Shaodong</td>
<td style="text-align: right;">15775.17</td>
<td style="text-align: right;">17128.14</td>
<td style="text-align: left;">POLYGON ((827858.7 2945904,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Suining</td>
<td style="text-align: right;">14382.86</td>
<td style="text-align: right;">14593.62</td>
<td style="text-align: left;">POLYGON ((678946.5 2903356,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wugang</td>
<td style="text-align: right;">11566.33</td>
<td style="text-align: right;">11644.29</td>
<td style="text-align: left;">POLYGON ((738995.8 2899208,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Xinning</td>
<td style="text-align: right;">13199.50</td>
<td style="text-align: right;">12706.00</td>
<td style="text-align: left;">POLYGON ((748750.9 2878860,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Xinshao</td>
<td style="text-align: right;">23412.00</td>
<td style="text-align: right;">21712.29</td>
<td style="text-align: left;">POLYGON ((796346.4 2964043,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Shaoshan</td>
<td style="text-align: right;">39541.00</td>
<td style="text-align: right;">43548.25</td>
<td style="text-align: left;">POLYGON ((886350.3 3014311,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Xiangxiang</td>
<td style="text-align: right;">36186.60</td>
<td style="text-align: right;">35049.00</td>
<td style="text-align: left;">POLYGON ((877379.7 3022683,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Baojing</td>
<td style="text-align: right;">16559.60</td>
<td style="text-align: right;">16226.83</td>
<td style="text-align: left;">POLYGON ((601273.4 3092068,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fenghuang</td>
<td style="text-align: right;">20772.50</td>
<td style="text-align: right;">19294.40</td>
<td style="text-align: left;">POLYGON ((587249 3020500, 5…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Guzhang</td>
<td style="text-align: right;">19471.20</td>
<td style="text-align: right;">18156.00</td>
<td style="text-align: left;">POLYGON ((620888.1 3083237,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Huayuan</td>
<td style="text-align: right;">19827.33</td>
<td style="text-align: right;">19954.75</td>
<td style="text-align: left;">POLYGON ((589011.7 3067928,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jishou</td>
<td style="text-align: right;">15466.80</td>
<td style="text-align: right;">18145.17</td>
<td style="text-align: left;">POLYGON ((616595 3052847, 6…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Longshan</td>
<td style="text-align: right;">12925.67</td>
<td style="text-align: right;">12132.75</td>
<td style="text-align: left;">POLYGON ((590246.8 3180293,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Luxi</td>
<td style="text-align: right;">18577.17</td>
<td style="text-align: right;">18419.29</td>
<td style="text-align: left;">POLYGON ((643343 3048504, 6…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Yongshun</td>
<td style="text-align: right;">14943.00</td>
<td style="text-align: right;">14050.83</td>
<td style="text-align: left;">POLYGON ((627795.4 3145425,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Anhua</td>
<td style="text-align: right;">24913.00</td>
<td style="text-align: right;">23619.75</td>
<td style="text-align: left;">POLYGON ((789009.7 3081509,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nan</td>
<td style="text-align: right;">25093.00</td>
<td style="text-align: right;">24552.71</td>
<td style="text-align: left;">POLYGON ((853111.1 3178170,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yuanjiang</td>
<td style="text-align: right;">24428.80</td>
<td style="text-align: right;">24733.67</td>
<td style="text-align: left;">POLYGON ((866754 3147605, 8…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jianghua</td>
<td style="text-align: right;">17003.00</td>
<td style="text-align: right;">16762.60</td>
<td style="text-align: left;">POLYGON ((816357.7 2709600,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lanshan</td>
<td style="text-align: right;">21143.75</td>
<td style="text-align: right;">20932.60</td>
<td style="text-align: left;">POLYGON ((873168.1 2748284,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ningyuan</td>
<td style="text-align: right;">20435.00</td>
<td style="text-align: right;">19467.75</td>
<td style="text-align: left;">POLYGON ((853845.3 2801658,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Shuangpai</td>
<td style="text-align: right;">17131.33</td>
<td style="text-align: right;">18334.00</td>
<td style="text-align: left;">POLYGON ((835079.5 2802787,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Xintian</td>
<td style="text-align: right;">24569.75</td>
<td style="text-align: right;">22541.00</td>
<td style="text-align: left;">POLYGON ((872752.4 2800712,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Huarong</td>
<td style="text-align: right;">23835.50</td>
<td style="text-align: right;">26028.00</td>
<td style="text-align: left;">POLYGON ((909742.6 3208358,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Linxiang</td>
<td style="text-align: right;">26360.00</td>
<td style="text-align: right;">29128.50</td>
<td style="text-align: left;">POLYGON ((970905.9 3211447,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Miluo</td>
<td style="text-align: right;">47383.40</td>
<td style="text-align: right;">46569.00</td>
<td style="text-align: left;">POLYGON ((922076.2 3134116,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pingjiang</td>
<td style="text-align: right;">55157.75</td>
<td style="text-align: right;">47576.60</td>
<td style="text-align: left;">POLYGON ((1005450 3145461, …</td>
</tr>
<tr class="even">
<td style="text-align: left;">Xiangyin</td>
<td style="text-align: right;">37058.00</td>
<td style="text-align: right;">36545.50</td>
<td style="text-align: left;">POLYGON ((915261.6 3129236,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cili</td>
<td style="text-align: right;">21546.67</td>
<td style="text-align: right;">20838.50</td>
<td style="text-align: left;">POLYGON ((711106.1 3194274,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chaling</td>
<td style="text-align: right;">23348.67</td>
<td style="text-align: right;">22531.00</td>
<td style="text-align: left;">POLYGON ((1015909 2926248, …</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Liling</td>
<td style="text-align: right;">42323.67</td>
<td style="text-align: right;">42115.50</td>
<td style="text-align: left;">POLYGON ((988558.1 3018277,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yanling</td>
<td style="text-align: right;">28938.60</td>
<td style="text-align: right;">27619.00</td>
<td style="text-align: left;">POLYGON ((1036591 2872725, …</td>
</tr>
<tr class="odd">
<td style="text-align: left;">You</td>
<td style="text-align: right;">25880.80</td>
<td style="text-align: right;">27611.33</td>
<td style="text-align: left;">POLYGON ((995331 2959198, 9…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Zhuzhou</td>
<td style="text-align: right;">47345.67</td>
<td style="text-align: right;">44523.29</td>
<td style="text-align: left;">POLYGON ((956308.2 3024789,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sangzhi</td>
<td style="text-align: right;">18711.33</td>
<td style="text-align: right;">18127.43</td>
<td style="text-align: left;">POLYGON ((681259.9 3160705,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yueyang</td>
<td style="text-align: right;">29087.29</td>
<td style="text-align: right;">28746.38</td>
<td style="text-align: left;">POLYGON ((951297.3 3202661,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Qiyang</td>
<td style="text-align: right;">20748.29</td>
<td style="text-align: right;">20734.50</td>
<td style="text-align: left;">POLYGON ((797197.9 2878034,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Taojiang</td>
<td style="text-align: right;">35933.71</td>
<td style="text-align: right;">33880.62</td>
<td style="text-align: left;">POLYGON ((832713.3 3088425,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Shaoyang</td>
<td style="text-align: right;">15439.71</td>
<td style="text-align: right;">14716.38</td>
<td style="text-align: left;">POLYGON ((788361.9 2932157,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lianyuan</td>
<td style="text-align: right;">29787.50</td>
<td style="text-align: right;">28516.22</td>
<td style="text-align: left;">POLYGON ((800853.9 3014299,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hongjiang</td>
<td style="text-align: right;">18145.00</td>
<td style="text-align: right;">18086.14</td>
<td style="text-align: left;">POLYGON ((652450.5 2943812,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hengyang</td>
<td style="text-align: right;">21617.00</td>
<td style="text-align: right;">21244.50</td>
<td style="text-align: left;">POLYGON ((911692.2 2904962,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Guiyang</td>
<td style="text-align: right;">29203.89</td>
<td style="text-align: right;">29568.80</td>
<td style="text-align: left;">POLYGON ((955964.6 2803036,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Changsha</td>
<td style="text-align: right;">41363.67</td>
<td style="text-align: right;">48119.71</td>
<td style="text-align: left;">POLYGON ((925766.9 3023920,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Taoyuan</td>
<td style="text-align: right;">22259.09</td>
<td style="text-align: right;">22310.75</td>
<td style="text-align: left;">POLYGON ((828601.9 3161592,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Xiangtan</td>
<td style="text-align: right;">44939.56</td>
<td style="text-align: right;">43151.60</td>
<td style="text-align: left;">POLYGON ((936937.8 3008710,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dao</td>
<td style="text-align: right;">16902.00</td>
<td style="text-align: right;">17133.40</td>
<td style="text-align: left;">POLYGON ((797995.7 2766682,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jiangyong</td>
<td style="text-align: right;">16930.00</td>
<td style="text-align: right;">17009.33</td>
<td style="text-align: left;">POLYGON ((787361.7 2718895,…</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>And plot it to compare</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Hands-on_Ex04_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="spatial-window-sum" class="level2">
<h2 class="anchored" data-anchor-id="spatial-window-sum">Spatial Window Sum</h2>
<p>The spatial window sum is similar to the window average, but we are not using the row-standardized weights.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
 [1] "Anxiang"       "Hanshou"       "Jinshi"        "Li"           
 [5] "Linli"         "Shimen"        "Liuyang"       "Ningxiang"    
 [9] "Wangcheng"     "Anren"         "Guidong"       "Jiahe"        
[13] "Linwu"         "Rucheng"       "Yizhang"       "Yongxing"     
[17] "Zixing"        "Changning"     "Hengdong"      "Hengnan"      
[21] "Hengshan"      "Leiyang"       "Qidong"        "Chenxi"       
[25] "Zhongfang"     "Huitong"       "Jingzhou"      "Mayang"       
[29] "Tongdao"       "Xinhuang"      "Xupu"          "Yuanling"     
[33] "Zhijiang"      "Lengshuijiang" "Shuangfeng"    "Xinhua"       
[37] "Chengbu"       "Dongan"        "Dongkou"       "Longhui"      
[41] "Shaodong"      "Suining"       "Wugang"        "Xinning"      
[45] "Xinshao"       "Shaoshan"      "Xiangxiang"    "Baojing"      
[49] "Fenghuang"     "Guzhang"       "Huayuan"       "Jishou"       
[53] "Longshan"      "Luxi"          "Yongshun"      "Anhua"        
[57] "Nan"           "Yuanjiang"     "Jianghua"      "Lanshan"      
[61] "Ningyuan"      "Shuangpai"     "Xintian"       "Huarong"      
[65] "Linxiang"      "Miluo"         "Pingjiang"     "Xiangyin"     
[69] "Cili"          "Chaling"       "Liling"        "Yanling"      
[73] "You"           "Zhuzhou"       "Sangzhi"       "Yueyang"      
[77] "Qiyang"        "Taojiang"      "Shaoyang"      "Lianyuan"     
[81] "Hongjiang"     "Hengyang"      "Guiyang"       "Changsha"     
[85] "Taoyuan"       "Xiangtan"      "Dao"           "Jiangyong"    

[[2]]
 [1] 124236 113624  96573 110950 109081 106244 174988 235079 273907 256221
[11]  98013 104050 102846  92017 133831 158446 141883 119508 150757 153324
[21] 113593 129594 142149 100119  82884  74668  43184  99244  46549  20518
[31] 140576 121601  92069  43258 144567 132119  51694  59024  69349  73780
[41]  94651 100680  69398  52798 140472 118623 180933  82798  83090  97356
[51]  59482  77334  38777 111463  74715 174391 150558 122144  68012  84575
[61] 143045  51394  98279  47671  26360 236917 220631 185290  64640  70046
[71] 126971 144693 129404 284074 112268 203611 145238 251536 108078 238300
[81] 108870 108085 262835 248182 244850 404456  67608  33860</code></pre>
</div>
</div>
<p>Now we can compare it with both kable() and qtm()</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 19%">
<col style="width: 16%">
<col style="width: 43%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">County</th>
<th style="text-align: right;">lag_sum GDPPC</th>
<th style="text-align: right;">w_sum GDPPC</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Anxiang</td>
<td style="text-align: right;">124236</td>
<td style="text-align: right;">124236</td>
<td style="text-align: left;">POLYGON ((825339.4 3209148,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hanshou</td>
<td style="text-align: right;">113624</td>
<td style="text-align: right;">113624</td>
<td style="text-align: left;">POLYGON ((846673.4 3139165,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jinshi</td>
<td style="text-align: right;">96573</td>
<td style="text-align: right;">96573</td>
<td style="text-align: left;">POLYGON ((810038.7 3190827,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Li</td>
<td style="text-align: right;">110950</td>
<td style="text-align: right;">110950</td>
<td style="text-align: left;">POLYGON ((756935.9 3225838,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Linli</td>
<td style="text-align: right;">109081</td>
<td style="text-align: right;">109081</td>
<td style="text-align: left;">POLYGON ((783475.6 3207079,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Shimen</td>
<td style="text-align: right;">106244</td>
<td style="text-align: right;">106244</td>
<td style="text-align: left;">POLYGON ((708206.5 3241744,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Liuyang</td>
<td style="text-align: right;">174988</td>
<td style="text-align: right;">174988</td>
<td style="text-align: left;">POLYGON ((1024633 3091569, …</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ningxiang</td>
<td style="text-align: right;">235079</td>
<td style="text-align: right;">235079</td>
<td style="text-align: left;">POLYGON ((900741.8 3060845,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wangcheng</td>
<td style="text-align: right;">273907</td>
<td style="text-align: right;">273907</td>
<td style="text-align: left;">POLYGON ((906766.3 3077439,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Anren</td>
<td style="text-align: right;">256221</td>
<td style="text-align: right;">256221</td>
<td style="text-align: left;">POLYGON ((959144.5 2890585,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Guidong</td>
<td style="text-align: right;">98013</td>
<td style="text-align: right;">98013</td>
<td style="text-align: left;">POLYGON ((1065564 2828411, …</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jiahe</td>
<td style="text-align: right;">104050</td>
<td style="text-align: right;">104050</td>
<td style="text-align: left;">POLYGON ((893838.3 2764449,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Linwu</td>
<td style="text-align: right;">102846</td>
<td style="text-align: right;">102846</td>
<td style="text-align: left;">POLYGON ((910317.1 2744004,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rucheng</td>
<td style="text-align: right;">92017</td>
<td style="text-align: right;">92017</td>
<td style="text-align: left;">POLYGON ((1017476 2788033, …</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Yizhang</td>
<td style="text-align: right;">133831</td>
<td style="text-align: right;">133831</td>
<td style="text-align: left;">POLYGON ((977190.9 2763499,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yongxing</td>
<td style="text-align: right;">158446</td>
<td style="text-align: right;">158446</td>
<td style="text-align: left;">POLYGON ((976718.2 2845964,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Zixing</td>
<td style="text-align: right;">141883</td>
<td style="text-align: right;">141883</td>
<td style="text-align: left;">POLYGON ((1020609 2820527, …</td>
</tr>
<tr class="even">
<td style="text-align: left;">Changning</td>
<td style="text-align: right;">119508</td>
<td style="text-align: right;">119508</td>
<td style="text-align: left;">POLYGON ((904677 2861393, 9…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hengdong</td>
<td style="text-align: right;">150757</td>
<td style="text-align: right;">150757</td>
<td style="text-align: left;">POLYGON ((948954.5 2932803,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hengnan</td>
<td style="text-align: right;">153324</td>
<td style="text-align: right;">153324</td>
<td style="text-align: left;">POLYGON ((916277.6 2904767,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hengshan</td>
<td style="text-align: right;">113593</td>
<td style="text-align: right;">113593</td>
<td style="text-align: left;">POLYGON ((897149.3 2958067,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Leiyang</td>
<td style="text-align: right;">129594</td>
<td style="text-align: right;">129594</td>
<td style="text-align: left;">POLYGON ((942592.9 2874262,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Qidong</td>
<td style="text-align: right;">142149</td>
<td style="text-align: right;">142149</td>
<td style="text-align: left;">POLYGON ((818150.6 2904520,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chenxi</td>
<td style="text-align: right;">100119</td>
<td style="text-align: right;">100119</td>
<td style="text-align: left;">POLYGON ((659836.5 3027008,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Zhongfang</td>
<td style="text-align: right;">82884</td>
<td style="text-align: right;">82884</td>
<td style="text-align: left;">POLYGON ((631117.1 2970989,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Huitong</td>
<td style="text-align: right;">74668</td>
<td style="text-align: right;">74668</td>
<td style="text-align: left;">POLYGON ((634422.1 2901669,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jingzhou</td>
<td style="text-align: right;">43184</td>
<td style="text-align: right;">43184</td>
<td style="text-align: left;">POLYGON ((623976.4 2862538,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mayang</td>
<td style="text-align: right;">99244</td>
<td style="text-align: right;">99244</td>
<td style="text-align: left;">POLYGON ((615109.7 2998224,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tongdao</td>
<td style="text-align: right;">46549</td>
<td style="text-align: right;">46549</td>
<td style="text-align: left;">POLYGON ((636593.9 2830511,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Xinhuang</td>
<td style="text-align: right;">20518</td>
<td style="text-align: right;">20518</td>
<td style="text-align: left;">POLYGON ((561722.2 2935313,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Xupu</td>
<td style="text-align: right;">140576</td>
<td style="text-align: right;">140576</td>
<td style="text-align: left;">POLYGON ((704263.2 3039179,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yuanling</td>
<td style="text-align: right;">121601</td>
<td style="text-align: right;">121601</td>
<td style="text-align: left;">POLYGON ((723892.4 3117846,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Zhijiang</td>
<td style="text-align: right;">92069</td>
<td style="text-align: right;">92069</td>
<td style="text-align: left;">POLYGON ((625721.6 2957129,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lengshuijiang</td>
<td style="text-align: right;">43258</td>
<td style="text-align: right;">43258</td>
<td style="text-align: left;">POLYGON ((787713 2989441, 7…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Shuangfeng</td>
<td style="text-align: right;">144567</td>
<td style="text-align: right;">144567</td>
<td style="text-align: left;">POLYGON ((861128.6 2981916,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Xinhua</td>
<td style="text-align: right;">132119</td>
<td style="text-align: right;">132119</td>
<td style="text-align: left;">POLYGON ((765661.4 3030736,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chengbu</td>
<td style="text-align: right;">51694</td>
<td style="text-align: right;">51694</td>
<td style="text-align: left;">POLYGON ((686942.1 2858390,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dongan</td>
<td style="text-align: right;">59024</td>
<td style="text-align: right;">59024</td>
<td style="text-align: left;">POLYGON ((786516 2883527, 7…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dongkou</td>
<td style="text-align: right;">69349</td>
<td style="text-align: right;">69349</td>
<td style="text-align: left;">POLYGON ((704480.6 2935185,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Longhui</td>
<td style="text-align: right;">73780</td>
<td style="text-align: right;">73780</td>
<td style="text-align: left;">POLYGON ((734695.4 2968915,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Shaodong</td>
<td style="text-align: right;">94651</td>
<td style="text-align: right;">94651</td>
<td style="text-align: left;">POLYGON ((827858.7 2945904,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Suining</td>
<td style="text-align: right;">100680</td>
<td style="text-align: right;">100680</td>
<td style="text-align: left;">POLYGON ((678946.5 2903356,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wugang</td>
<td style="text-align: right;">69398</td>
<td style="text-align: right;">69398</td>
<td style="text-align: left;">POLYGON ((738995.8 2899208,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Xinning</td>
<td style="text-align: right;">52798</td>
<td style="text-align: right;">52798</td>
<td style="text-align: left;">POLYGON ((748750.9 2878860,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Xinshao</td>
<td style="text-align: right;">140472</td>
<td style="text-align: right;">140472</td>
<td style="text-align: left;">POLYGON ((796346.4 2964043,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Shaoshan</td>
<td style="text-align: right;">118623</td>
<td style="text-align: right;">118623</td>
<td style="text-align: left;">POLYGON ((886350.3 3014311,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Xiangxiang</td>
<td style="text-align: right;">180933</td>
<td style="text-align: right;">180933</td>
<td style="text-align: left;">POLYGON ((877379.7 3022683,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Baojing</td>
<td style="text-align: right;">82798</td>
<td style="text-align: right;">82798</td>
<td style="text-align: left;">POLYGON ((601273.4 3092068,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fenghuang</td>
<td style="text-align: right;">83090</td>
<td style="text-align: right;">83090</td>
<td style="text-align: left;">POLYGON ((587249 3020500, 5…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Guzhang</td>
<td style="text-align: right;">97356</td>
<td style="text-align: right;">97356</td>
<td style="text-align: left;">POLYGON ((620888.1 3083237,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Huayuan</td>
<td style="text-align: right;">59482</td>
<td style="text-align: right;">59482</td>
<td style="text-align: left;">POLYGON ((589011.7 3067928,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jishou</td>
<td style="text-align: right;">77334</td>
<td style="text-align: right;">77334</td>
<td style="text-align: left;">POLYGON ((616595 3052847, 6…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Longshan</td>
<td style="text-align: right;">38777</td>
<td style="text-align: right;">38777</td>
<td style="text-align: left;">POLYGON ((590246.8 3180293,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Luxi</td>
<td style="text-align: right;">111463</td>
<td style="text-align: right;">111463</td>
<td style="text-align: left;">POLYGON ((643343 3048504, 6…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Yongshun</td>
<td style="text-align: right;">74715</td>
<td style="text-align: right;">74715</td>
<td style="text-align: left;">POLYGON ((627795.4 3145425,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Anhua</td>
<td style="text-align: right;">174391</td>
<td style="text-align: right;">174391</td>
<td style="text-align: left;">POLYGON ((789009.7 3081509,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nan</td>
<td style="text-align: right;">150558</td>
<td style="text-align: right;">150558</td>
<td style="text-align: left;">POLYGON ((853111.1 3178170,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yuanjiang</td>
<td style="text-align: right;">122144</td>
<td style="text-align: right;">122144</td>
<td style="text-align: left;">POLYGON ((866754 3147605, 8…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jianghua</td>
<td style="text-align: right;">68012</td>
<td style="text-align: right;">68012</td>
<td style="text-align: left;">POLYGON ((816357.7 2709600,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lanshan</td>
<td style="text-align: right;">84575</td>
<td style="text-align: right;">84575</td>
<td style="text-align: left;">POLYGON ((873168.1 2748284,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ningyuan</td>
<td style="text-align: right;">143045</td>
<td style="text-align: right;">143045</td>
<td style="text-align: left;">POLYGON ((853845.3 2801658,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Shuangpai</td>
<td style="text-align: right;">51394</td>
<td style="text-align: right;">51394</td>
<td style="text-align: left;">POLYGON ((835079.5 2802787,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Xintian</td>
<td style="text-align: right;">98279</td>
<td style="text-align: right;">98279</td>
<td style="text-align: left;">POLYGON ((872752.4 2800712,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Huarong</td>
<td style="text-align: right;">47671</td>
<td style="text-align: right;">47671</td>
<td style="text-align: left;">POLYGON ((909742.6 3208358,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Linxiang</td>
<td style="text-align: right;">26360</td>
<td style="text-align: right;">26360</td>
<td style="text-align: left;">POLYGON ((970905.9 3211447,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Miluo</td>
<td style="text-align: right;">236917</td>
<td style="text-align: right;">236917</td>
<td style="text-align: left;">POLYGON ((922076.2 3134116,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pingjiang</td>
<td style="text-align: right;">220631</td>
<td style="text-align: right;">220631</td>
<td style="text-align: left;">POLYGON ((1005450 3145461, …</td>
</tr>
<tr class="even">
<td style="text-align: left;">Xiangyin</td>
<td style="text-align: right;">185290</td>
<td style="text-align: right;">185290</td>
<td style="text-align: left;">POLYGON ((915261.6 3129236,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cili</td>
<td style="text-align: right;">64640</td>
<td style="text-align: right;">64640</td>
<td style="text-align: left;">POLYGON ((711106.1 3194274,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chaling</td>
<td style="text-align: right;">70046</td>
<td style="text-align: right;">70046</td>
<td style="text-align: left;">POLYGON ((1015909 2926248, …</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Liling</td>
<td style="text-align: right;">126971</td>
<td style="text-align: right;">126971</td>
<td style="text-align: left;">POLYGON ((988558.1 3018277,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yanling</td>
<td style="text-align: right;">144693</td>
<td style="text-align: right;">144693</td>
<td style="text-align: left;">POLYGON ((1036591 2872725, …</td>
</tr>
<tr class="odd">
<td style="text-align: left;">You</td>
<td style="text-align: right;">129404</td>
<td style="text-align: right;">129404</td>
<td style="text-align: left;">POLYGON ((995331 2959198, 9…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Zhuzhou</td>
<td style="text-align: right;">284074</td>
<td style="text-align: right;">284074</td>
<td style="text-align: left;">POLYGON ((956308.2 3024789,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sangzhi</td>
<td style="text-align: right;">112268</td>
<td style="text-align: right;">112268</td>
<td style="text-align: left;">POLYGON ((681259.9 3160705,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yueyang</td>
<td style="text-align: right;">203611</td>
<td style="text-align: right;">203611</td>
<td style="text-align: left;">POLYGON ((951297.3 3202661,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Qiyang</td>
<td style="text-align: right;">145238</td>
<td style="text-align: right;">145238</td>
<td style="text-align: left;">POLYGON ((797197.9 2878034,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Taojiang</td>
<td style="text-align: right;">251536</td>
<td style="text-align: right;">251536</td>
<td style="text-align: left;">POLYGON ((832713.3 3088425,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Shaoyang</td>
<td style="text-align: right;">108078</td>
<td style="text-align: right;">108078</td>
<td style="text-align: left;">POLYGON ((788361.9 2932157,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lianyuan</td>
<td style="text-align: right;">238300</td>
<td style="text-align: right;">238300</td>
<td style="text-align: left;">POLYGON ((800853.9 3014299,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hongjiang</td>
<td style="text-align: right;">108870</td>
<td style="text-align: right;">108870</td>
<td style="text-align: left;">POLYGON ((652450.5 2943812,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hengyang</td>
<td style="text-align: right;">108085</td>
<td style="text-align: right;">108085</td>
<td style="text-align: left;">POLYGON ((911692.2 2904962,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Guiyang</td>
<td style="text-align: right;">262835</td>
<td style="text-align: right;">262835</td>
<td style="text-align: left;">POLYGON ((955964.6 2803036,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Changsha</td>
<td style="text-align: right;">248182</td>
<td style="text-align: right;">248182</td>
<td style="text-align: left;">POLYGON ((925766.9 3023920,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Taoyuan</td>
<td style="text-align: right;">244850</td>
<td style="text-align: right;">244850</td>
<td style="text-align: left;">POLYGON ((828601.9 3161592,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Xiangtan</td>
<td style="text-align: right;">404456</td>
<td style="text-align: right;">404456</td>
<td style="text-align: left;">POLYGON ((936937.8 3008710,…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dao</td>
<td style="text-align: right;">67608</td>
<td style="text-align: right;">67608</td>
<td style="text-align: left;">POLYGON ((797995.7 2766682,…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jiangyong</td>
<td style="text-align: right;">33860</td>
<td style="text-align: right;">33860</td>
<td style="text-align: left;">POLYGON ((787361.7 2718895,…</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<p><img src="Hands-on_Ex04_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>